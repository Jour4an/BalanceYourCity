
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Balance Your City</title>
<style>
  body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(to bottom, #001F3D, #004080);
    margin: 0;
    padding: 0;
    color: #FFFFFF;
  }
  header {
    background-color: #002a4d;
    padding: 20px;
    text-align: center;
    color: #FF9936;
    font-size: 2em;
    font-weight: 900;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .section {
    background: #FFFFFF;
    color: #001F3D;
    border-radius: 16px;
    padding: 30px;
    margin: 20px auto;
    max-width: 1000px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
  }
  .budget-buttons strong {
    display: inline-block;
    padding: 10px;
    margin: 5px;
    border-radius: 8px;
    color: #fff;
  }
  .operating { background-color: #0071BF; }
  .capital { background-color: #FF9936; }
  .total { background-color: #004080; }
  .dropdown {
    padding: 10px;
    font-size: 1em;
    border-radius: 8px;
    margin: 10px 0;
    width: 100%;
  }
  .progress-bar {
    width: 100%;
    background-color: #ddd;
    border-radius: 8px;
    overflow: hidden;
    margin-top: 10px;
  }
  .progress-fill {
    height: 20px;
    background-color: #FF9936;
    width: 0%;
    transition: width 0.3s ease;
  }
  .warning {
    color: #b30000;
    font-weight: bold;
    margin-top: 10px;
  }
  .service {
    display: flex;
    flex-direction: column;
    margin: 15px 0;
  }
  .service span {
    font-weight: bold;
  }
  .impact {
    font-size: 0.9em;
    color: #b30000;
    margin-top: 5px;
  }
  .service input {
    width: 120px;
    margin-top: 5px;
    color: red;
    font-weight: bold;
  }
  .button {
    background-color: #FF9936;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 1em;
    margin-top: 20px;
  }
</style>
</head>
<body>
<header>Balance Your City</header>
<div class="section">
  <p>You're the budget director of a growing municipality. The operating budget requires at least a <strong>3% tax increase</strong> to maintain current service levels. Choose your tax increase and make tough decisions to fund projects and balance the budget.</p>

  <label for="yearSelect">Select Year:</label>
  <select id="yearSelect" class="dropdown"></select>

  <label for="taxRate">Tax Increase (%):</label>
  <input type="number" id="taxRate" min="0" max="15" value="3">

  <div id="taxWarning" class="warning"></div>

  <label for="projectSelect">Choose a Capital Project:</label>
  <select id="projectSelect" class="dropdown">
    <option value="0">No Project ($0)</option>
    <option value="2000000">Recreation Center ($2,000,000)</option>
    <option value="3500000">Road Expansion ($3,500,000)</option>
    <option value="4000000">Water Treatment Upgrade ($4,000,000)</option>
    <option value="1500000">Library Renovation ($1,500,000)</option>
    <option value="2500000">Fire Station Upgrade ($2,500,000)</option>
  </select>

  <div id="projectWarning" class="warning"></div>

  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  <div class="budget-buttons" id="budgetInfo"></div>
  <div id="shortfallDisplay"></div>
  <div id="reductionChoices"></div>
  <button class="button" id="submitBtn">Submit Reductions</button>
  <div id="result"></div>
  <button class="button locked" id="nextYearBtn">Next Year</button>
</div>

<script>
const yearSelect = document.getElementById('yearSelect');
const taxRateInput = document.getElementById('taxRate');
const projectSelect = document.getElementById('projectSelect');
const progressFill = document.getElementById('progressFill');
const budgetInfo = document.getElementById('budgetInfo');
const shortfallDisplay = document.getElementById('shortfallDisplay');
const reductionChoices = document.getElementById('reductionChoices');
const taxWarning = document.getElementById('taxWarning');
const projectWarning = document.getElementById('projectWarning');
const submitBtn = document.getElementById('submitBtn');
const result = document.getElementById('result');
const nextYearBtn = document.getElementById('nextYearBtn');

const baseRevenue = 30000000; // City of Brooks operating budget
const data = [];
for (let y = 1; y <= 5; y++) {
  const operating = Math.round(baseRevenue * Math.pow(1.03, y) / 10000) * 10000;
  data.push({ year: y, operating });
}

const departments = {
  "Fire & Police": { base: 5000000, impact: "Longer emergency response times." },
  "Water & Utilities": { base: 4500000, impact: "Possible boil-water advisories." },
  "Roads & Snow Clearing": { base: 4000000, impact: "Slower snow removal and pothole repairs." },
  "Parks & Recreation": { base: 2000000, impact: "Fewer community events and delayed playground repairs." },
  "Waste & Recycling": { base: 1500000, impact: "Garbage pickup every 2 weeks instead of weekly." },
  "Libraries & Community Services": { base: 1200000, impact: "Reduced hours and fewer programs." },
  "Planning & Development": { base: 1000000, impact: "Delayed zoning and permit approvals." }
};

let currentYear = 1;

function formatCurrency(value) {
  return `$${value.toLocaleString()}`;
}

function populateYearOptions() {
  yearSelect.innerHTML = '';
  data.forEach(entry => {
    const option = document.createElement('option');
    option.value = entry.year;
    option.textContent = `Year ${entry.year}`;
    if (entry.year !== 1) option.disabled = true;
    yearSelect.appendChild(option);
  });
  yearSelect.value = "1";
}

function updateDisplay() {
  const year = parseInt(yearSelect.value);
  const taxRate = parseFloat(taxRateInput.value);
  const projectCost = parseInt(projectSelect.value);
  const entry = data[year - 1];
  const revenue = baseRevenue * (1 + taxRate / 100);
  const extraRevenue = taxRate > 3 ? (taxRate - 3) * baseRevenue / 100 : 0;
  const funded = Math.min(extraRevenue, projectCost);
  const shortfall = entry.operating + projectCost - revenue;

  taxWarning.textContent = taxRate < 3 ? "⚠️ Warning: You're underfunding operations!" : "";
  projectWarning.textContent = projectCost > 0 ? "⚠️ If you choose a capital project, you must raise taxes or decrease a department’s service level by taking funding away." : "";

  progressFill.style.width = projectCost > 0 ? `${(funded / projectCost) * 100}%` : "0%";
  budgetInfo.innerHTML = `
    <strong class='operating'>Operating: ${formatCurrency(entry.operating)}</strong>
    <strong class='capital'>Project: ${formatCurrency(projectCost)}</strong>
    <strong class='total'>Total: ${formatCurrency(entry.operating + projectCost)}</strong>
  `;
  shortfallDisplay.innerHTML = `<strong>Remaining Shortfall:</strong> ${formatCurrency(shortfall > 0 ? shortfall : 0)}`;

  reductionChoices.innerHTML = '<strong>Reduce funding from departments (increments of $10,000):</strong>';
  for (const [dept, info] of Object.entries(departments)) {
    const adjusted = Math.round(info.base * Math.pow(1.03, year) / 10000) * 10000;
    reductionChoices.innerHTML += `
      <div class="service">
        <span>${dept} (${formatCurrency(adjusted)}):</span>
        <input type="number" step="10000" min="0" max="${adjusted}" value="0" id="${dept.replace(/\s|&/g, '')}" oninput="showImpact('${dept}', this.value)">
        <div class="impact" id="impact-${dept.replace(/\s|&/g, '')}"></div>
      </div>
    `;
  }
  result.innerHTML = '';
  nextYearBtn.classList.add('locked');
}

function showImpact(dept, value) {
  const impactDiv = document.getElementById(`impact-${dept.replace(/\s|&/g, '')}`);
  const amount = parseInt(value) || 0;
  if (amount > 0) {
    let severity = Math.floor(amount / 50000);
    impactDiv.textContent = `Consequence: ${departments[dept].impact} Severity Level: ${severity}`;
  } else {
    impactDiv.textContent = '';
  }
  updateShortfall();
}

function updateShortfall() {
  const year = parseInt(yearSelect.value);
  const taxRate = parseFloat(taxRateInput.value);
  const projectCost = parseInt(projectSelect.value);
  const entry = data[year - 1];
  const revenue = baseRevenue * (1 + taxRate / 100);
  let shortfall = entry.operating + projectCost - revenue;
  for (const dept of Object.keys(departments)) {
    const input = document.getElementById(dept.replace(/\s|&/g, ''));
    shortfall -= parseInt(input.value) || 0;
  }
  shortfallDisplay.innerHTML = `<strong>Remaining Shortfall:</strong> ${formatCurrency(shortfall > 0 ? shortfall : 0)}`;
}

function calculateReductions() {
  const year = parseInt(yearSelect.value);
  const taxRate = parseFloat(taxRateInput.value);
  const projectCost = parseInt(projectSelect.value);
  const entry = data[year - 1];
  const revenue = baseRevenue * (1 + taxRate / 100);
  const shortfall = entry.operating + projectCost - revenue;
  let totalReduction = 0;
  let breakdown = '';

  for (const dept of Object.keys(departments)) {
    const input = document.getElementById(dept.replace(/\s|&/g, ''));
    const value = parseInt(input.value) || 0;
    totalReduction += value;
    if (value > 0) {
      breakdown += `<li>${dept}: ${formatCurrency(value)}</li>`;
    }
  }

  if (totalReduction >= shortfall) {
    result.innerHTML = `<strong>✅ Success!</strong> You've balanced the budget for Year ${year}.<br><strong>Reductions:</strong><ul>${breakdown}</ul>`;
    nextYearBtn.classList.remove('locked');
    yearSelect.options[year].disabled = false;
  } else {
    result.innerHTML = `<strong>🚨 Not enough reductions.</strong> You still need to cut ${formatCurrency(shortfall - totalReduction)}.`;
  }
}

function goToNextYear() {
  if (!nextYearBtn.classList.contains('locked')) {
    currentYear++;
    if (currentYear <= 5) {
      yearSelect.value = currentYear;
      updateDisplay();
    } else {
      result.innerHTML = `<strong>🎉 You've completed all 5 years! Your municipality is thriving thanks to your leadership.`;
      nextYearBtn.classList.add('locked');
    }
  }
}

taxRateInput.addEventListener('input', updateDisplay);
yearSelect.addEventListener('change', updateDisplay);
projectSelect.addEventListener('change', updateDisplay);
submitBtn.addEventListener('click', calculateReductions);
nextYearBtn.addEventListener('click', goToNextYear);

populateYearOptions();
updateDisplay();
</script>
</body>
</html>
