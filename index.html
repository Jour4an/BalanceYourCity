<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Balance Your City</title>
https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap
<style>
  body {
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(to bottom, #001F3D, #004080);
    margin: 0;
    padding: 0;
    color: #001F3D;
  }
  header {
    background-color: #002a4d;
    padding: 20px;
    text-align: center;
    color: #FF9936;
    font-size: 2em;
    font-weight: 900;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }
  .section {
    background: #FFFFFF;
    border-radius: 16px;
    padding: 30px;
    margin: 20px auto;
    max-width: 1000px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
  }
  .status {
    display: inline-block;
    padding: 14px 24px;
    margin: 16px 0;
    border-radius: 8px;
    font-weight: 700;
    font-size: 1.3em;
    color: #fff;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    transition: background-color 0.4s ease;
  }
  .status.red { background-color: #b30000; }
  .status.green { background-color: #28a745; }
  input[type="number"] {
    padding: 10px;
    font-size: 1em;
    border-radius: 8px;
    margin: 10px 0;
    width: 100%;
    color: #001F3D;
    font-weight: 700;
  }
  .projects {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 12px;
    margin: 20px 0;
  }
  .project-btn {
    background-color: #0071BF;
    color: white;
    border: none;
    padding: 12px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 1em;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    transition: background-color 0.3s ease, transform 0.2s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .project-btn.selected {
    background-color: #005a99;
  }
  .project-btn:hover {
    transform: scale(1.05);
  }
  .deadline {
    font-size: 0.8em;
    color: #FFD700;
    text-align: center;
    margin-top: 6px;
  }
  .service {
    margin: 20px 0;
    display: flex;
    flex-direction: column;
    width: 100%;
  }
  .slider-container input[type="range"] {
    width: 100%;
    height: 12px;
    background: #ddd;
    border-radius: 8px;
    cursor: pointer;
  }
  .slider-container input[type="range"]::-webkit-slider-thumb {
    background: #FF9936;
    border-radius: 50%;
    height: 32px;
    width: 32px;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  .slider-container input[type="range"]:hover::-webkit-slider-thumb {
    transform: scale(1.2);
  }
  .impact {
    font-size: 0.9em;
    color: #b30000;
    margin-top: 5px;
  }
  .button {
    background-color: #FF9936;
    color: white;
    border: none;
    padding: 14px 28px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 1.1em;
    margin-top: 20px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    transition: background-color 0.3s ease, transform 0.2s ease;
  }
  .button:hover {
    background-color: #e6832f;
    transform: scale(1.05);
  }
  .warning {
    color: #b30000;
    font-weight: bold;
    margin-top: 10px;
  }
</style>
</head>
<body>
<header>Balance Your City</header>
<div class="section">
  <h2 id="yearTitle">Year 1</h2>
  <p>You have 4 years to manage the city budget. Increase taxes, fund projects, and adjust department budgets. Some projects have deadlines—fail to complete them on time, and critical failures occur!</p>

  <label for="taxRate">Tax Increase (%):</label>
  <input type="number" id="taxRate" min="0" max="25" value="3">

  <h3>Select Capital Projects:</h3>
  <div class="projects" id="projectButtons"></div>

  <div><strong id="statusDisplay" class="status red">Shortfall: $0</strong></div>
  <div id="criticalWarning" class="warning"></div>
  <div id="reductionChoices"></div>
  <button class="button" id="resetBtn">Reset Year</button>
  <button class="button" id="nextYearBtn" style="display:none;">Next Year</button>
  <button class="button" id="prevYearBtn" style="display:none;">Previous Year</button>
</div>

<script>
const taxRateInput = document.getElementById('taxRate');
const projectButtonsContainer = document.getElementById('projectButtons');
const statusDisplay = document.getElementById('statusDisplay');
const reductionChoices = document.getElementById('reductionChoices');
const resetBtn = document.getElementById('resetBtn');
const nextYearBtn = document.getElementById('nextYearBtn');
const prevYearBtn = document.getElementById('prevYearBtn');
const yearTitle = document.getElementById('yearTitle');
const criticalWarning = document.getElementById('criticalWarning');

const operatingCost = 31500000; // Fixed at 3% baseline for all years
let currentYear = 1;
let yearData = [{ projects: [] }];
let waterTreatmentSelected = false;
let fireTruckSelected = false;

const projects = [
  { name: "Recreation Center", cost: 2000000 },
  { name: "Road Expansion", cost: 3500000 },
  { name: "Water Treatment Upgrade", cost: 4000000, deadline: 3 },
  { name: "Library Renovation", cost: 1500000 },
  { name: "Fire Station Upgrade", cost: 2500000 },
  { name: "Community Pool", cost: 1800000 },
  { name: "Sports Complex", cost: 3000000 },
  { name: "Transit Hub", cost: 2200000 },
  { name: "Bike Path Network", cost: 1200000 },
  { name: "City Hall Renovation", cost: 3500000 }, // No deadline
  { name: "New Fire Truck", cost: 800000, deadline: 4 }
];

const departments = {
  "Fire & Police": {},
  "Water & Utilities": {},
  "Roads & Snow Clearing": {},
  "Parks & Recreation": {},
  "Waste & Recycling": {},
  "Libraries & Community Services": {},
  "Planning & Development": {}
};

let selectedProjects = [];

function formatCurrency(value) {
  return `$${Number(value).toLocaleString()}`;
}

function createProjectButtons() {
  projectButtonsContainer.innerHTML = '';
  projects.forEach((proj, index) => {
    const btn = document.createElement('button');
    btn.className = 'project-btn';
    btn.textContent = `${proj.name} (${formatCurrency(proj.cost)})`;
    if (proj.deadline) {
      const deadlineTag = document.createElement('div');
      deadlineTag.className = 'deadline';
      deadlineTag.textContent = `Complete by Year ${proj.deadline}`;
      btn.appendChild(deadlineTag);
    }
    btn.onclick = () => {
      if (selectedProjects.includes(index)) {
        selectedProjects = selectedProjects.filter(i => i !== index);
        btn.classList.remove('selected');
      } else {
        selectedProjects.push(index);
        btn.classList.add('selected');
      }
      if (proj.name === "Water Treatment Upgrade") waterTreatmentSelected = true;
      if (proj.name === "New Fire Truck") fireTruckSelected = true;
      updateStatus();
    };
    projectButtonsContainer.appendChild(btn);
  });
}

function updateDisplay() {
  reductionChoices.innerHTML = '';
  for (const dept of Object.keys(departments)) {
    reductionChoices.innerHTML += `
      <div class="service">
        <span>${dept}</span>
        <div class="slider-container">
          <input type="range" step="10" min="0" max="100" value="100" id="${dept.replace(/\\s|&/g, '')}" oninput="updateDept('${dept}', this.value)">
          <span id="value-${dept.replace(/\\s|&/g, '')}" style="font-weight:bold;color:black;">100%</span>
        </div>
        <div class="impact" id="impact-${dept.replace(/\\s|&/g, '')}"></div>
      </div>
    `;
  }
  updateStatus();
}

function updateDept(dept, percent) {
  document.getElementById(`value-${dept.replace(/\\s|&/g, '')}`).textContent = `${percent}%`;
  const impactDiv = document.getElementById(`impact-${dept.replace(/\\s|&/g, '')}`);
  const severity = (100 - percent) / 10;
  if (severity === 0) {
    impactDiv.textContent = '';
  } else if (severity === 1) {
    impactDiv.textContent = 'Minor inconvenience.';
  } else if (severity === 2) {
    impactDiv.textContent = 'Noticeable delays.';
  } else if (severity === 3) {
    impactDiv.textContent = 'Service disruptions.';
  } else if (severity === 4) {
    impactDiv.textContent = 'Major impact.';
  } else {
    impactDiv.textContent = 'Critical failures.';
  }
  updateStatus();
}

function updateStatus() {
  const taxRate = parseFloat(taxRateInput.value);
  const revenue = 30000000 + (taxRate * 500000); // $500k per 1%

  let projectCost = selectedProjects.reduce((sum, idx) => sum + projects[idx].cost, 0);
  let shortfall = operatingCost + projectCost - revenue;

  let reductions = 0;
  for (const dept of Object.keys(departments)) {
    const slider = document.getElementById(dept.replace(/\\s|&/g, ''));
    const percent = parseInt(slider.value);
    reductions += ((100 - percent) / 10) * 200000; // $200k per 10%
  }

  shortfall -= reductions;

  let surplus = 0;
  if (shortfall < 0) {
    surplus = Math.abs(shortfall);
    shortfall = 0;
  }

  statusDisplay.textContent = shortfall > 0 ? `Shortfall: ${formatCurrency(shortfall)}` : `Surplus: ${formatCurrency(surplus)}`;
  statusDisplay.className = shortfall > 0 ? 'status red' : 'status green';

  nextYearBtn.style.display = shortfall === 0 ? 'inline-block' : 'none';
  prevYearBtn.style.display = currentYear > 1 ? 'inline-block' : 'none';
}

nextYearBtn.addEventListener('click', () => {
  if (currentYear === 3 && !waterTreatmentSelected) {
    criticalWarning.textContent = "⚠️ You must select Water Treatment Upgrade before moving to Year 4!";
    return;
  }
  yearData[currentYear - 1] = { projects: [...selectedProjects] };
  currentYear++;
  if (currentYear > 4) {
    if (!fireTruckSelected) {
      criticalWarning.textContent = "⚠️ Game Over: You cannot complete the term without selecting the New Fire Truck!";
      nextYearBtn.style.display = 'none';
      return;
    }
    criticalWarning.textContent = "✅ Congratulations! You completed the 4-year term successfully!";
    nextYearBtn.style.display = 'none';
    return;
  }
  yearTitle.textContent = `Year ${currentYear}`;
  checkCriticalDeadlines();
  updateDisplay();
});

prevYearBtn.addEventListener('click', () => {
  if (currentYear > 1) {
    currentYear--;
    yearTitle.textContent = `Year ${currentYear}`;
    selectedProjects = yearData[currentYear - 1]?.projects || [];
    updateDisplay();
  }
});

function checkCriticalDeadlines() {
  criticalWarning.textContent = '';
  projects.forEach((proj, idx) => {
    if (proj.deadline && currentYear > proj.deadline && !yearData.some(y => y.projects.includes(idx))) {
      criticalWarning.textContent = `⚠️ Critical Failure: ${proj.name} was not completed by Year ${proj.deadline}!`;
    }
  });
}

resetBtn.addEventListener('click', () => {
  taxRateInput.value = 3;
  selectedProjects = [];
  createProjectButtons();
  updateDisplay();
});

taxRateInput.addEventListener('input', updateStatus);

createProjectButtons();
updateDisplay();
</script>
</body>
</html>